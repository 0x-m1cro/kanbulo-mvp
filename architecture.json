{
  "path": "agent-output/architecture/system-architecture.md",
  "content": "# Kanbulo - System Architecture\n\n**Last Updated**: 2025-12-16\n**Architect**: ZeroDev (Architect Agent)\n**Status**: Initial Definition\n\n## 1. Architectural Vision\n**\"The Velvet Curtain\"**: A decoupled architecture designed to separate the *emotional experience* (Frontend) from the *operational reality* (Backend/POD). The system must prioritize UI fluidity and tone-of-voice compliance over standard e-commerce conventions.\n\n## 2. High-Level Components\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| **Storefront (Headless)** | Next.js (React) | Renders the \"Soft/Tender\" UX. Controls animations, routing, and visual fidelity. Hosting: Vercel. |\n| **Commerce Backend** | Shopify Plus/Advanced | Handles Catalog, Cart, Checkout, and Customer Accounts. Acts as the \"Truth\" for product data. |\n| **Content Management** | Sanity.io (or Shopify Metafields) | Manages the \"Storytelling\" content (Journal, nuances of product descriptions) distinct from commercial data. |\n| **Fulfillment Layer** | Printful API / Zazzle | **INVISIBLE TO USER**. Receives orders via Shopify webhooks. Handles production. |\n| **Middleware (The Curtain)** | Next.js API Routes | Sanitizes responses. Transforms \"System Status\" into \"Brand Voice\" (e.g., error handling). |\n\n## 3. Data Boundaries & Compliance\n\n### A. Product Data Flow\n1. **Input**: Admin enters product in Shopify. Tags: `Made in USA`, `Ethical`. \n2. **Sanitization**: Middleware ensures NO reference to `Printful`, `POD`, or `Drop-ship` is passed to the frontend API response.\n3. **Display**: Frontend renders \"Made with Tenderness in the USA\".\n\n### B. Order Data Flow\n1. **User Action**: Checkout completes on Kanbulo (Shopify Checkout). \n2. **System Action**: Shopify triggers webhook to Printful.\n3. **Sanitization**: Tracking emails are intercepted/customized by Kanbulo (via Klaviyo or Shopify Email) to remove manufacturer branding.\n\n## 4. Diagram: The Velvet Curtain Pattern\n\n```mermaid\ngraph TD\n    User((Parent/User)) -->|Interacts with Tender UI| Frontend[Next.js Storefront]\n    \n    subgraph \"The Velvet Curtain (Middleware)\"\n        Frontend -->|Sanitized Queries| API[Next.js API Routes]\n    end\n    \n    subgraph \"Backend Operations (Hidden)\"\n        API -->|Storefront API| Shopify[Shopify Backend]\n        Shopify -->|Webhooks| POD[Printful / Zazzle]\n        Shopify -->|Sync| CMS[Sanity/Metafields]\n    end\n    \n    POD -.->|Shipment Status| Shopify\n    Shopify -.->|Branded Email| User\n```\n\n## 5. Quality Attributes\n* **Performance**: \"Un-hurried\" does not mean slow. Pages must load instantly (LCP < 1.2s) to maintain the feeling of \"quality.\"\n* **Aesthetics**: The architecture must support custom framer-motion animations (e.g., page transitions that fade/blur rather than hard cut).\n* **Resilience**: If POD APIs fail, the site must gracefully degrade to \"Pre-order\" mode without showing technical errors.\n\n## 6. Recommendations & Debt\n* **Recommendation**: Use **Shopify Hydrogen** or straight **Next.js Commerce** as the starter kit to save time on plumbing.\n* **Risk**: Complexity of Headless. Managing the Checkout redirection (Shopify checkout is hosted) requires careful branding to ensure the transition doesn't feel jarring.\n\n## 7. Change Log\n| Date | Change | Rationale |\n|------|--------|-----------|\n| 2025-12-16 | Initial Architecture Created | Establishing Headless pattern to meet Brand Core requirements. |\n"
}